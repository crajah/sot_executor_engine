{
  "name": "schemaname",
  "version": "version1",
  "schemas": [
    {
      "type": "protobuf",
      "id": "protoschema1",
      "version": "version2",
      "definition": {
        "type": "protobufdefinition",
        "name": "Message",
        "schemaBase64": "cGFja2FnZSBjb3JlOw0KDQpvcHRpb24gamF2YV9wYWNrYWdlID0gInNvdC5leGVjdXRvciI7DQpvcHRpb24gamF2YV9vdXRlcl9jbGFzc25hbWUgPSAiQ29yZU1vZGVsIjsNCg0KbWVzc2FnZSBNZXNzYWdlIHsNCiAgICANCiAgICBtZXNzYWdlIE5lc3RlZENsYXNzIHsNCiAgICAgICAgcmVxdWlyZWQgaW50NjQgdmFsdWUgPSAxOw0KICAgIH0NCg0KICAgIHJlcXVpcmVkIHN0cmluZyB1c2VyID0gMTsNCiAgICByZXF1aXJlZCBzdHJpbmcgdGVhbU5hbWUgPSAyOw0KICAgIHJlcXVpcmVkIGludDY0IHNjb3JlID0gMzsNCiAgICByZXF1aXJlZCBpbnQ2NCBldmVudFRpbWUgPSA0Ow0KICAgIHJlcXVpcmVkIHN0cmluZyBldmVudFRpbWVTdHIgPSA1Ow0KICAgIHJlcGVhdGVkIE5lc3RlZENsYXNzIG5lc3RlZFZhbHVlID0gNjsNCg0KfQ==",
        "doc": "A basic schema for storing user records"
      }
    },
    {
      "type": "bigquery",
      "id": "bigqueryschema1",
      "version": "version3",
      "definition": {
        "type": "bigquerydefinition",
        "name": "BigQueryRow",
        "fields": [
          {
            "mode": "REQUIRED",
            "name": "user",
            "type": "STRING"
          },
          {
            "mode": "REQUIRED",
            "name": "teamName",
            "type": "STRING"
          },
          {
            "mode": "REQUIRED",
            "name": "score",
            "type": "INTEGER"
          },
          {
            "mode": "REQUIRED",
            "name": "eventTime",
            "type": "INTEGER"
          },
          {
            "mode": "REQUIRED",
            "name": "eventTimeStr",
            "type": "STRING"
          },
          {
            "mode": "REPEATED",
            "name": "nestedValue",
            "type": "RECORD",
            "fields": [
              {
                "mode": "REQUIRED",
                "name": "value",
                "type": "INTEGER"
              }
            ]
          },
          {
            "mode": "REQUIRED",
            "name": "score2",
            "type": "FLOAT"
          },
          {
            "mode": "REQUIRED",
            "name": "processingTime",
            "type": "STRING"
          }
        ]
      }
    }
  ],
  "taps": [
    {
      "type": "pubsub",
      "id": "pubsubsource1",
      "topic": "p2pin"
    },
    {
      "type": "bigquery",
      "id": "bigquerysource1",
      "dataset": "bigquerytest",
      "table": "streaming_word_extract26"
    }
  ],
  "steps": [
    {
      "type": "source",
      "name": "in",
      "schema": "protoschema1",
      "source": "pubsubsource1"
    },
    {
      "type": "transformation",
      "name": "filter",
      "op": "filter",
      "func": "m => m.get('score) > 2"
    },
    {
      "type": "transformation",
      "name": "mapper1",
      "op": "map",
      "func": "m => m.append('score2, m.get('score) * 0.23)"
    },
    {
      "type": "transformation",
      "name": "mapper2",
      "op": "map",
      "func": "m => m.append('processingTime, Helper.fmt.print(Instant.now()))"
    },
    {
      "type": "sink",
      "name": "out",
      "schema": "bigqueryschema1",
      "source": "bigquerysource1"
    }
  ],
  "dag": [
    {
      "from": "in",
      "to": "filter"
    },
    {
      "from": "mapper1",
      "to": "mapper2"
    },
    {
      "from": "filter",
      "to": "mapper1"
    },
    {
      "from": "mapper2",
      "to": "out"
    }
  ]
}